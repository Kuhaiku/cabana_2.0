<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Agenda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  </head>
  <body class="bg-slate-50 flex">
    <aside class="w-64 bg-slate-900 text-white h-screen fixed p-6">
      <div class="text-xl font-bold mb-8 text-pink-500">Cabana Admin</div>
      <nav class="space-y-4">
        <a href="painel.html" class="block hover:text-pink-400">Pedidos</a>
        <a href="agenda.html" class="block font-bold text-pink-400">Agenda</a>
        <a href="financeiro.html" class="block hover:text-pink-400"
          >Financeiro</a
        >
        <a href="precos.html" class="block hover:text-pink-400">Estoque</a>
      </nav>
    </aside>
    <main class="ml-64 p-8 w-full">
      <div class="bg-white p-6 rounded shadow h-[80vh]" id="calendar"></div>
    </main>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const calendarEl = document.getElementById("calendar");
        const calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: "dayGridMonth",
          locale: "pt-br",
          events: {
            url: "/api/admin/agenda",
            extraParams: {
              "x-admin-password": localStorage.getItem("admin_pass"),
            },
          },
          eventClick: function (info) {
            if (
              confirm(
                "Concluir serviço e liberar avaliação para " +
                  info.event.title +
                  "?",
              )
            ) {
              fetch(`/api/admin/pedidos/${info.event.id}/concluir`, {
                method: "PUT",
                headers: {
                  "x-admin-password": localStorage.getItem("admin_pass"),
                },
              }).then(() => {
                alert("Concluído!");
                info.event.remove();
              });
            }
          },
        });
        calendar.render();
      });
    </script>
  </body>
</html>
