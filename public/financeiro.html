<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Financeiro</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-slate-50 flex">
    <aside class="w-64 bg-slate-900 text-white h-screen fixed p-6">
      <div class="text-xl font-bold mb-8 text-pink-500">Cabana Admin</div>
      <nav class="space-y-4">
        <a href="painel.html" class="block hover:text-pink-400">Pedidos</a>
        <a href="agenda.html" class="block hover:text-pink-400">Agenda</a>
        <a href="financeiro.html" class="block font-bold text-pink-400"
          >Financeiro</a
        >
        <a href="precos.html" class="block hover:text-pink-400">Estoque</a>
      </nav>
    </aside>
    <main class="ml-64 p-8 w-full">
      <div class="flex justify-between mb-6">
        <h1 class="text-2xl font-bold">Fluxo de Caixa</h1>
        <button
          onclick="add()"
          class="bg-pink-500 text-white px-4 py-2 rounded"
        >
          Novo Lançamento
        </button>
      </div>
      <div class="bg-white rounded shadow overflow-hidden">
        <table class="w-full text-left">
          <thead class="bg-slate-100">
            <tr>
              <th class="p-4">Data</th>
              <th class="p-4">Título</th>
              <th class="p-4">Valor</th>
            </tr>
          </thead>
          <tbody id="tb"></tbody>
        </table>
      </div>
    </main>
    <script>
      async function load() {
        const res = await fetch("/api/admin/financeiro", {
          headers: { "x-admin-password": localStorage.getItem("admin_pass") },
        });
        const list = await res.json();
        document.getElementById("tb").innerHTML = list
          .map(
            (i) => `
                <tr class="border-b"><td class="p-4">${new Date(i.data).toLocaleDateString()}</td><td class="p-4">${i.titulo}</td><td class="p-4 ${i.tipo === "entrada" ? "text-green-600" : "text-red-600"}">R$ ${parseFloat(i.valor).toFixed(2)}</td></tr>
            `,
          )
          .join("");
      }
      async function add() {
        const titulo = prompt("Descrição:");
        const valor = prompt("Valor (Use negativo para saídas):");
        if (titulo && valor) {
          await fetch("/api/admin/financeiro", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "x-admin-password": localStorage.getItem("admin_pass"),
            },
            body: JSON.stringify({
              tipo: valor < 0 ? "saida" : "entrada",
              titulo,
              valor: Math.abs(valor),
            }),
          });
          load();
        }
      }
      load();
    </script>
  </body>
</html>
